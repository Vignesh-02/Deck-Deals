<%- include("../partials/header");-%>

<section class="max-w-6xl mx-auto px-4 sm:px-6 py-10 sm:py-14">
  <div class="grid lg:grid-cols-[320px_1fr] gap-8 lg:gap-10 items-start">
    <aside class="space-y-5 order-2 lg:order-1">
      <div class="rounded-2xl border border-slate-800 bg-slate-900/60 p-5 shadow-lg shadow-black/20">
        <h2 class="text-sm font-semibold uppercase tracking-wider text-slate-400 mb-4">Seller information</h2>
        <ul class="space-y-3 text-slate-200">
          <li class="flex justify-between gap-3 text-sm">
            <span class="text-slate-500 shrink-0">Contact</span>
            <span class="font-medium text-right break-all"><%= deck.mobile %></span>
          </li>
          <li class="flex justify-between gap-3 text-sm">
            <span class="text-slate-500 shrink-0">Email</span>
            <span class="font-medium text-right break-all"><%= deck.email %></span>
          </li>
          <li class="flex justify-between gap-3 text-sm">
            <span class="text-slate-500 shrink-0">Address</span>
            <span class="font-medium text-right text-slate-200"><%= deck.address %></span>
          </li>
        </ul>
      </div>
      <div class="rounded-2xl border border-slate-800 bg-slate-900/60 p-4 text-sm text-slate-300">
        <p><span class="font-semibold text-slate-200">Stock:</span> <%= deck.stock %> decks</p>
        <p class="mt-2 flex items-center gap-2 text-slate-400">
          <span class="h-1.5 w-1.5 rounded-full bg-emerald-400"></span>
          Ready to ship worldwide
        </p>
      </div>
      <% if(currentUser && deck.author.id.equals(currentUser._id)){ %>
        <div class="space-y-3">
          <a href="/decks/<%= deck._id %>/edit"
            class="block w-full text-center rounded-xl border border-slate-700 bg-slate-800/80 py-2.5 text-sm font-semibold text-slate-200 hover:bg-primary-600 hover:border-primary-500 hover:text-white transition-all">
            Edit deck
          </a>
          <form action="/decks/<%= deck._id %>?_method=DELETE" method="POST">
            <button type="submit" class="block w-full rounded-xl bg-red-600/90 py-2.5 text-sm font-semibold text-white hover:bg-red-500 transition-colors">
              Delete deck
            </button>
          </form>
        </div>
      <% } %>
    </aside>

    <div class="space-y-8 order-1 lg:order-2">
      <article class="rounded-2xl border border-slate-800 bg-slate-900/60 overflow-hidden shadow-xl shadow-black/20">
        <div class="relative bg-black flex items-center justify-center">
          <img src="<%= deck.image %>" alt="<%= deck.name %>" class="w-full max-h-[520px] object-contain" />
          <div class="absolute inset-0 bg-gradient-to-t from-black/60 to-transparent pointer-events-none"></div>
        </div>
        <div class="p-6 sm:p-8 space-y-5">
          <div class="flex flex-wrap items-start justify-between gap-4">
            <div>
              <h1 class="text-2xl sm:text-3xl font-bold text-slate-50 tracking-tight"><%= deck.name %></h1>
              <p class="mt-1 text-slate-400 text-sm">Submitted by <span class="font-medium text-slate-200"><%= deck.author.username %></span></p>
            </div>
            <div class="text-right">
              <p class="text-xs uppercase tracking-wider text-slate-500">Price</p>
              <p class="text-2xl font-bold text-emerald-400">$<%= deck.price %> <span class="text-sm font-normal text-slate-500">/ deck</span></p>
            </div>
          </div>
          <p class="text-slate-200 leading-relaxed"><%= deck.description %></p>
          <div class="flex flex-wrap items-center justify-between gap-4 pt-2 border-t border-slate-800">
            <p class="text-sm text-slate-400"><span class="font-semibold text-slate-200"><%= deck.stock %></span> decks available · grab yours before it’s gone.</p>
            <a href="/decks/<%= deck._id %>/comments/new"
              class="inline-flex items-center justify-center rounded-xl bg-gradient-to-r from-primary-500 to-primary-600 px-5 py-2.5 text-sm font-semibold text-white shadow-lg shadow-primary-500/25 hover:shadow-primary-500/40 transition-all">
              + Add a review
            </a>
          </div>
        </div>
      </article>

      <section class="rounded-2xl border border-slate-800 bg-slate-900/60 p-6 shadow-lg shadow-black/20">
        <div class="flex items-center justify-between gap-4 mb-5">
          <h2 class="text-lg font-semibold text-slate-100 tracking-tight">Reviews</h2>
          <span class="text-sm text-slate-500"><%= deck.comments.length %> comment<%= deck.comments.length !== 1 ? 's' : '' %></span>
        </div>
        <% if(deck.comments.length === 0){ %>
          <div class="rounded-xl border border-dashed border-slate-700 bg-slate-800/30 px-6 py-8 text-center text-slate-400 text-sm">
            No reviews yet. Be the first to drop your thoughts on this deck.
          </div>
        <% } else { %>
          <ul class="space-y-4">
            <% deck.comments.forEach(function(comment){ %>
              <li class="rounded-xl border border-slate-800 bg-slate-800/40 px-4 py-4 sm:px-5">
                <div class="flex flex-col sm:flex-row sm:items-start sm:justify-between gap-3">
                  <div class="min-w-0">
                    <p class="text-sm font-semibold text-slate-100"><%= comment.author.username %></p>
                    <p class="mt-1 text-slate-200 text-sm leading-relaxed"><%= comment.text %></p>
                  </div>
                  <div class="flex items-center gap-2 shrink-0">
                    <span class="text-xs text-slate-500">
                            <%
                                var commentDate = comment._id.getTimestamp();
                            %>
                            <%= moment(commentDate).fromNow() %>
                    </span>
                    <% if(currentUser && comment.author.id.equals(currentUser._id)){ %>
                      <a href="/decks/<%= deck._id %>/comments/<%= comment._id %>/edit" class="rounded-lg border border-slate-600 bg-slate-700/50 px-2.5 py-1 text-xs font-medium text-slate-200 hover:border-primary-500 hover:text-primary-200 transition-colors">Edit</a>
                      <form action="/decks/<%= deck._id %>/comments/<%= comment._id %>?_method=DELETE" method="POST" class="inline">
                        <button type="submit" class="rounded-lg bg-red-600/90 px-2.5 py-1 text-xs font-medium text-white hover:bg-red-500 transition-colors">Delete</button>
                      </form>
                    <% } %>
                  </div>
                </div>
              </li>
            <% }) %>
          </ul>
        <% } %>
      </section>
    </div>
  </div>
</section>

<%- include("../partials/footer");-%>
